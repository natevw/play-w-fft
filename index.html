<!doctype html>
<html><head>
  <meta charset="utf-8">
  <title>Play w/FFT</title>
</head><body>
  <h1>Play with FFT</h1>
  
  <div id=buff>
    <label>
      <input class="count" type="number" value=512> samples
    </label> @ <label>
      <input class="rate" type="number" value=2000> samples/second.
    </label>
  <div>
  
  <div id=wave0>
    <label>
      Amplitude (%)
      <input class="amp" type="range" min=0 max=100>
    </label>
    <label>
      Frequency (Hz)
      <input class="freq" type="range" min=0 max=1000 value=42>
    </label>
    <label>
      Phase (ยบ)
      <input class="phase" type="range" min=-180 max=180>
    </label>
  </div>
  
  <canvas id=viz>[visualizer]</canvas>
  
  <script>
    const DEG2RAD = Math.PI / 180;
    const AMP_SCALE = 127 / 100;
    
    const form = document.querySelector("#wave0");
    function readVals() {
      let n = document.querySelector("#buff .count").value,
          r = document.querySelector("#buff .rate").value;
      let a = form.querySelector(".amp").value,
          f = form.querySelector(".freq").value,
          p = form.querySelector(".phase").value;
      return {numSamples:n,samplesPerSecond:r,a,f,p};
    }
    function update() {
      const vals = readVals();
      const wave = genWave(vals);
      console.log(wave);
      redraw(wave, vals);
    }
    document.querySelector("#buff").addEventListener('input', update, false);
    form.addEventListener('input', update, false);
    
    const canvas = document.querySelector("#viz");
    const ctx = canvas.getContext("2d");
    function redraw(wave, {a,f,p}) {
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.beginPath();
      ctx.strokeStyle = "grey";
      ctx.moveTo(0, canvas.height / 2);
      ctx.lineTo(canvas.width, canvas.height / 2);
      ctx.stroke();
      
      ctx.strokeStyle = "green";
      wave.forEach((n, idx) => {
        const x = canvas.width * idx / wave.length;
        const y = (1 + n / 127) * (canvas.height / 2);
        ctx.moveTo(x, canvas.height / 2);
        ctx.lineTo(x, y);
        ctx.stroke();
      });
      
      
      const LX = 5;
      const LY = 0;
      const LH = 15;
      ctx.fillStyle = "white";
      ctx.fillText(`Amplitude: ${a}%`, LX, LY + 1 * LH);
      ctx.fillText(`Frequency: ${f} Hz`, LX, LY + 2 * LH);
      ctx.fillText(`Phase: ${p}ยบ`, LX, LY + 3 * LH);
    }
    update();
    
    
    function genWave({numSamples: n, samplesPerSecond: r, a,f,p}) {
      let arr = new Array(n);
      for (let i = 0; i < n; ++i) {
        let t = i / r;    // t = (i / n) * l; l = n / r
        let s = AMP_SCALE * a * Math.sin(2 * Math.PI * f * t + p * DEG2RAD);
        arr[i] = Math.round(s);
      }
      return arr;
    }
  </script>
  
</body>